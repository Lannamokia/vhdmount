# Windows 11 VHD替换故障排除指南

## 问题描述
在Windows 11系统上，VHD文件替换可能会失败，这通常是由于Win11增强的安全策略和文件保护机制导致的。

## 常见错误原因

### 1. 权限问题
- **症状**: 提示"权限不足，无法替换文件"
- **原因**: Win11的UAC（用户账户控制）更加严格
- **解决方案**: 
  - 右键点击程序，选择"以管理员身份运行"
  - 或者在程序属性中设置"始终以管理员身份运行"

### 2. 文件属性问题
- **症状**: 文件无法删除或替换
- **原因**: Win11可能自动设置VHD文件为只读、隐藏或系统文件
- **解决方案**: 程序现在会自动检测并移除这些属性

### 3. 文件被占用
- **症状**: 提示"文件被占用，无法删除"
- **原因**: VHD文件可能被Windows资源管理器或其他程序占用
- **解决方案**: 
  - 关闭所有文件资源管理器窗口
  - 确保没有其他程序正在访问VHD文件
  - 重启计算机后再尝试

### 4. Windows Defender实时保护
- **症状**: 文件操作被阻止或延迟
- **原因**: Windows Defender可能将VHD文件操作视为可疑行为
- **解决方案**: 
  - 临时禁用实时保护
  - 或将VHD文件夹添加到排除列表

## 程序改进功能

### 新增的Win11兼容性检查
程序现在包含以下改进：

1. **自动检测Win11**: 程序会自动识别是否运行在Windows 11上
2. **权限检查**: 检查程序是否以管理员身份运行
3. **文件属性修复**: 自动移除只读、隐藏、系统等属性
4. **文件占用检测**: 检查文件是否被其他程序占用
5. **详细错误报告**: 提供更详细的错误信息和诊断数据

### 诊断信息
程序会在状态栏显示以下信息：
- 操作系统版本
- 管理员权限状态
- 文件属性详情
- 具体的错误原因

## 手动排除步骤

### 步骤1: 检查权限
1. 右键点击VHDMounter.exe
2. 选择"属性" → "兼容性"
3. 勾选"以管理员身份运行此程序"
4. 点击"确定"

### 步骤2: 检查文件属性
1. 右键点击VHD文件
2. 选择"属性"
3. 取消勾选"只读"
4. 在"高级"中取消勾选"隐藏"和"系统"

### 步骤3: 检查Windows Defender
1. 打开Windows安全中心
2. 转到"病毒和威胁防护"
3. 在"病毒和威胁防护设置"中点击"管理设置"
4. 临时关闭"实时保护"或添加排除项

### 步骤4: 检查磁盘空间
确保目标磁盘有足够的空间存储VHD文件

### 步骤5: 重启服务
如果问题持续，尝试重启以下服务：
- Windows资源管理器 (explorer.exe)
- 虚拟磁盘服务 (vds)

## 联系支持
如果以上步骤都无法解决问题，请提供以下信息：
1. 程序显示的具体错误消息
2. Windows 11版本号
3. VHD文件大小和位置
4. 是否以管理员身份运行程序

## 预防措施
1. 始终以管理员身份运行程序
2. 定期检查VHD文件的属性设置
3. 保持Windows 11系统更新
4. 避免在系统保护的文件夹中存储VHD文件